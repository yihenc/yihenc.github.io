---
layout: default
---

<article class="post{% if page.toc %} post-with-toc{% endif %}">
  <div class="post-header">
    <h1 class="post-title">{{ page.title }}</h1>
    <div class="post-meta">
      {%- assign date_format = site.date_format | default: "%-d %b %Y" -%}
      <time datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">{{ page.date | date: date_format }}</time>
      {%- if page.last_modified_at -%}
        <span>&middot;</span>
        {%- assign mdate = page.last_modified_at | date_to_xmlschema -%}
        <time datetime="{{ mdate }}" itemprop="dateModified">
          Updated {{ mdate | date: date_format }}
        </time>
      {%- endif -%}
      {%- if page.author -%}
        <span>&middot;</span>
        {% for author in page.author %}
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            {{ author }}
          </span>
          {%- if forloop.last == false %}, {% endif -%}
        {% endfor %}
      {%- endif -%}
    </div>
  </div>

  {% if page.toc %}
  <aside class="toc-sidebar" id="toc-sidebar">
    <button class="toc-toggle" id="toc-toggle" aria-label="Toggle table of contents">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 3h12M2 8h8M2 13h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      <span class="toc-toggle-label">Contents</span>
    </button>
    <div class="toc-content" id="toc-content">
      <h2 class="toc-title">Contents</h2>
      <nav class="toc-nav">
        {% include toc.html html=content h_min=2 h_max=3 skipNoIDs=true class="toc" %}
      </nav>
    </div>
  </aside>
  {% endif %}

  <div class="post-body-wrapper" id="post-body-wrapper">
    <div class="post-body" id="post-body">
      {{ content }}
    </div>
  </div>

  <!-- Reading mode toggle -->
  <button class="reading-mode-toggle" id="reading-mode-toggle" title="Switch reading mode">
    <svg class="icon-scroll" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="4" y="1" width="10" height="16" rx="5" stroke="currentColor" stroke-width="1.5"/>
      <line x1="9" y1="5" x2="9" y2="8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
    <svg class="icon-page" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="1" width="14" height="16" rx="2" stroke="currentColor" stroke-width="1.5"/>
      <line x1="5" y1="6" x2="13" y2="6" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>
      <line x1="5" y1="9" x2="13" y2="9" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>
      <line x1="5" y1="12" x2="10" y2="12" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>
    </svg>
  </button>

  <!-- Paginated reading controls -->
  <div class="reading-paginator" id="reading-paginator">
    <button class="reading-page-btn" id="reading-prev" disabled>&larr; Prev</button>
    <span class="reading-page-info" id="reading-page-info">1 / 1</span>
    <button class="reading-page-btn" id="reading-next">Next &rarr;</button>
  </div>

  {% if page.tags.size > 0 %}
    {% include post-tags.html %}
  {% endif %}

  {% include share-buttons.html %}

  {% if jekyll.environment == "production" and site.disqus and page.comments != false %}
    {% include disqus.html %}
  {% endif %}
</article>

{% if site.related_posts != empty %}
<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    {% for post in site.related_posts limit:3 %}
      <li>
        <a href="{{ post.url | relative_url }}">
          {{ post.title }}
          <small><time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date_to_string }}</time></small>
        </a>
      </li>
    {% endfor %}
  </ul>
</aside>
{% endif %}

<script>
// TOC sidebar toggle (mobile)
(function() {
  var toggle = document.getElementById('toc-toggle');
  var sidebar = document.getElementById('toc-sidebar');
  if (!toggle || !sidebar) return;

  toggle.addEventListener('click', function() {
    sidebar.classList.toggle('toc-sidebar-open');
  });

  // Close TOC when clicking a link (mobile)
  var tocLinks = sidebar.querySelectorAll('.toc-nav a');
  tocLinks.forEach(function(link) {
    link.addEventListener('click', function() {
      if (window.innerWidth <= 1280) {
        sidebar.classList.remove('toc-sidebar-open');
      }
    });
  });
})();

// Reading mode toggle
(function() {
  var btn = document.getElementById('reading-mode-toggle');
  var wrapper = document.getElementById('post-body-wrapper');
  var body = document.getElementById('post-body');
  var paginator = document.getElementById('reading-paginator');
  var prevBtn = document.getElementById('reading-prev');
  var nextBtn = document.getElementById('reading-next');
  var pageInfo = document.getElementById('reading-page-info');
  if (!btn || !wrapper || !body) return;

  var isPaginated = false;
  var currentPage = 0;
  var totalPages = 1;
  var LINES_PER_PAGE = 40;
  var pageHeight = 0;

  function enablePaginated() {
    isPaginated = true;
    btn.classList.add('active');
    wrapper.classList.add('paginated-mode');

    // Calculate page height based on line height of the body content
    var style = window.getComputedStyle(body);
    var lineHeight = parseFloat(style.lineHeight);
    if (isNaN(lineHeight)) lineHeight = parseFloat(style.fontSize) * 1.75;
    pageHeight = Math.floor(lineHeight * LINES_PER_PAGE);

    // Set the wrapper as the scroll container with fixed height
    wrapper.style.height = pageHeight + 'px';
    wrapper.style.overflow = 'hidden';

    totalPages = Math.max(1, Math.ceil(body.scrollHeight / pageHeight));
    currentPage = 0;
    wrapper.scrollTop = 0;
    updatePaginator();
    paginator.style.display = 'flex';
  }

  function disablePaginated() {
    isPaginated = false;
    btn.classList.remove('active');
    wrapper.classList.remove('paginated-mode');
    wrapper.style.height = '';
    wrapper.style.overflow = '';
    wrapper.scrollTop = 0;
    paginator.style.display = 'none';
    currentPage = 0;
  }

  function updatePaginator() {
    pageInfo.textContent = (currentPage + 1) + ' / ' + totalPages;
    prevBtn.disabled = currentPage === 0;
    nextBtn.disabled = currentPage >= totalPages - 1;
  }

  function goToPage(page) {
    currentPage = Math.max(0, Math.min(page, totalPages - 1));
    wrapper.scrollTop = currentPage * pageHeight;
    updatePaginator();
  }

  btn.addEventListener('click', function() {
    if (isPaginated) {
      disablePaginated();
    } else {
      enablePaginated();
    }
  });

  prevBtn.addEventListener('click', function() { goToPage(currentPage - 1); });
  nextBtn.addEventListener('click', function() { goToPage(currentPage + 1); });

  // Keyboard navigation
  document.addEventListener('keydown', function(e) {
    if (!isPaginated) return;
    if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') { goToPage(currentPage - 1); e.preventDefault(); }
    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') { goToPage(currentPage + 1); e.preventDefault(); }
  });
})();
</script>
